<div class="space-y-4 sm:space-y-6" (click)="closeDropdown()">
  <!-- Breadcrumb -->
  <div class="flex items-start sm:items-center justify-between gap-2">
    <nav class="flex flex-wrap items-center gap-1 sm:gap-2 text-xs sm:text-sm">
      <a routerLink="/buyer/purchases" class="text-gray-600 hover:text-primary-500 whitespace-nowrap">Mes achats</a>
      <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <a [routerLink]="['/buyer/purchases', orderId]" class="text-gray-600 hover:text-primary-500 hidden sm:inline">Commande n° {{ orderNumber }}</a>
      <a [routerLink]="['/buyer/purchases', orderId]" class="text-gray-600 hover:text-primary-500 sm:hidden">Cmd</a>
      <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <a [routerLink]="['/buyer/purchases', orderId, 'tracking']" class="text-gray-600 hover:text-primary-500 whitespace-nowrap hidden sm:inline">Suivi</a>
      <svg class="w-3 h-3 sm:w-4 sm:h-4 text-gray-400 flex-shrink-0 hidden sm:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
      </svg>
      <span class="text-primary-500 font-medium whitespace-nowrap">Conformité</span>
    </nav>

    <!-- Menu 3 points -->
    <div class="relative flex-shrink-0">
      <button
        (click)="toggleDropdown($event)"
        class="p-2 hover:bg-gray-100 rounded-full transition-colors"
      >
        <svg class="w-5 h-5 text-gray-500" fill="currentColor" viewBox="0 0 20 20">
          <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Message -->
  <p class="text-xs sm:text-sm font-medium text-green-600">
    Vous avez accepté continuer. La livraison sera enclenchée et vous recevrez le colis.
  </p>

  <!-- Products List -->
  <div class="space-y-3">
    <div
      *ngFor="let item of items"
      class="bg-white rounded-md border border-gray-200 p-3 sm:p-4 flex flex-col sm:flex-row sm:items-center gap-3 sm:gap-4"
    >
      <!-- Product Image -->
      <img
        [src]="item.product.image"
        [alt]="item.product.name"
        class="w-14 h-14 sm:w-16 sm:h-16 rounded-md object-cover bg-primary-100 flex-shrink-0"
      />

      <!-- Product Info -->
      <div class="flex-1 min-w-0">
        <h3 class="font-medium text-gray-900 text-sm sm:text-base">{{ item.product.name }}</h3>
        <p class="text-xs sm:text-sm text-gray-600">
          Qté: {{ item.product.quantity }}
          <span class="hidden sm:inline">
            &nbsp;&nbsp;{{ item.product.variant1.label }}: <span class="font-medium">{{ item.product.variant1.value }}</span>
            &nbsp;&nbsp;{{ item.product.variant2.label }}: <span class="font-medium">{{ item.product.variant2.value }}</span>
          </span>
        </p>
      </div>

      <!-- Price -->
      <div class="hidden sm:block text-right flex-shrink-0">
        <span class="font-bold text-primary-500">{{ item.product.price }}{{ item.product.currency }}</span>
      </div>

      <!-- Status + Link -->
      <div class="flex items-center justify-between sm:justify-end gap-3 sm:gap-4">
        <!-- Price mobile -->
        <span class="font-bold text-primary-500 text-sm sm:hidden">{{ item.product.price }}{{ item.product.currency }}</span>

        <!-- Status Icon -->
        <div
          class="flex-shrink-0 w-7 h-7 sm:w-8 sm:h-8 rounded-full flex items-center justify-center"
          [ngClass]="getStatusClass(item.status)"
        >
          <svg *ngIf="item.status === 'compliant'" class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          <svg *ngIf="item.status === 'non_compliant'" class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
          <svg *ngIf="item.status === 'pending'" class="w-4 h-4 sm:w-5 sm:h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>

        <!-- Link -->
        <button
          (click)="openDetailModal(item)"
          class="text-xs sm:text-sm font-medium text-primary-500 hover:text-primary-600 whitespace-nowrap text-right"
        >
          <span class="hidden sm:inline">voir le détail<br/>du contrôle</span>
          <span class="sm:hidden">Détail</span>
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal Détail du contrôle -->
<app-compliance-detail-modal
  *ngIf="showDetailModal && selectedProduct && selectedResult"
  [product]="selectedProduct"
  [steps]="defaultSteps"
  [result]="selectedResult"
  (closed)="closeDetailModal()"
></app-compliance-detail-modal>